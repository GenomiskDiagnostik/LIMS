<!DOCTYPE html>
<html lang="da">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Relationsstyrke — Interaktiv model</title>
<style>
  :root{
    --bg:#0b1020; --fg:#f2f6ff; --muted:#b6c2e0; --accent:#7aa2ff; --card:#121a33; --grid:#2a355c;
    --ok:#39d98a; --warn:#ffd166; --bad:#ff6b6b;
  }
  html,body{margin:0;height:100%;background:var(--bg);color:var(--fg);font:14px/1.45 system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Ubuntu, Cantarell, Noto Sans, Arial, "Apple Color Emoji","Segoe UI Emoji"}
  h1,h2{margin:0 0 .4rem 0}
  h1{font-size:1.4rem}
  h2{font-size:1.1rem;color:var(--muted)}
  a{color:var(--accent)}
  .wrap{display:grid;grid-template-columns:320px 1fr;gap:16px;padding:16px;min-height:100%}
  .card{background:var(--card);border-radius:14px;box-shadow:0 4px 24px rgba(0,0,0,.25);padding:14px}
  .row{display:flex;gap:8px;align-items:center}
  .col{display:flex;flex-direction:column}
  .muted{color:var(--muted)}
  .sep{height:1px;background:#223; margin:10px 0}
  label{font-weight:600}
  input[type="range"]{width:100%}
  .num{width:90px}
  .pill{display:inline-flex;align-items:center;gap:6px;background:#0b1330;border:1px solid #223;border-radius:999px;padding:4px 10px}
  .btn{background:linear-gradient(180deg,#1e2b59,#162047);border:1px solid #2b3b75;color:#fff;padding:10px 12px;border-radius:12px;cursor:pointer;font-weight:600}
  .btn:active{transform:translateY(1px)}
  .btn.alt{background:#12204a}
  .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
  .badge{display:inline-block;padding:3px 8px;border-radius:8px;background:#10224a;border:1px solid #264; font-size:12px}
  .scoreBar{height:14px;background:#0b1330;border:1px solid #203; border-radius:8px;position:relative}
  .scoreBar>span{position:absolute;left:0;top:0;bottom:0;background:linear-gradient(90deg,var(--bad),var(--warn),var(--ok));border-radius:8px}
  canvas{width:100%;max-width:720px;aspect-ratio:1/1;background:#0a1125;border-radius:12px;border:1px solid #1f2b59}
  .tbl{width:100%;border-collapse:collapse}
  .tbl th,.tbl td{padding:6px 8px;border-bottom:1px solid #1c274d;text-align:left}
  .tbl th{color:var(--muted);font-weight:700}
  .flex{display:flex;gap:12px;flex-wrap:wrap}
  .tiny{font-size:12px}
  @media (max-width:980px){.wrap{grid-template-columns:1fr}}
</style>
</head>
<body>
  <div class="wrap">
    <!-- LEFT: Controls -->
    <div class="card">
      <h1>Relationsstyrke — interaktiv vægtning</h1>
      <p class="muted tiny">Indstil relationstype, dimensioner (0–1), varighed, interaktionsfrekvens og volatilitet. Modellen beregner samlet styrke og tegner et radarplot.</p>

      <div class="sep"></div>

      <div class="col" style="gap:10px">
        <div class="row">
          <label for="relType">Relationstype</label>
          <select id="relType" class="pill"></select>
          <button class="btn alt" id="loadPreset">Indlæs eksempelprofil</button>
        </div>
        <div class="grid">
          <div class="card" style="padding:10px">
            <div class="row"><label>Varighed (år)</label><input id="years" class="num" type="number" step="0.1" min="0" value="5"></div>
            <div class="row"><label>Interaktioner/uge</label><input id="perWeek" class="num" type="number" step="1" min="0" value="20"></div>
            <div class="row"><label>Volatilitet (0–1)</label><input id="vol" class="num" type="number" step="0.01" min="0" max="1" value="0.2"></div>
          </div>
          <div class="card" style="padding:10px">
            <div class="row"><span class="badge">D(år)</span><span id="dbgD" class="muted">–</span></div>
            <div class="row"><span class="badge">F(uge)</span><span id="dbgF" class="muted">–</span></div>
            <div class="row"><span class="badge">P(vol)</span><span id="dbgP" class="muted">–</span></div>
          </div>
        </div>
      </div>

      <div class="sep"></div>

      <h2>Dimensioner (0–1)</h2>
      <div id="dims"></div>

      <div class="sep"></div>

      <div class="row" style="justify-content:space-between">
        <div class="row" style="gap:6px">
          <button class="btn" id="recalc">Beregn</button>
          <button class="btn alt" id="reset">Nulstil (0.70)</button>
        </div>
        <div class="row">
          <button class="btn alt" id="saveJson">Gem profil (JSON)</button>
          <input id="jsonFile" type="file" accept="application/json" style="display:none"/>
          <button class="btn alt" id="loadJson">Indlæs JSON</button>
        </div>
      </div>

      <div class="sep"></div>

      <div class="col" style="gap:6px">
        <label>Samlet styrke</label>
        <div class="scoreBar"><span id="bar"></span></div>
        <div class="row" style="justify-content:space-between"><b id="scoreTxt">0</b><span class="muted tiny">(0–100)</span></div>
      </div>

    </div>

    <!-- RIGHT: Charts & Insights -->
    <div class="card">
      <h2 id="chartTitle">Radar-plot</h2>
      <canvas id="radar" width="900" height="900"></canvas>

      <div class="sep"></div>

      <div class="grid">
        <div>
          <h2>Styrker</h2>
          <ul id="strengths"></ul>
        </div>
        <div>
          <h2>Svagheder</h2>
          <ul id="weaknesses"></ul>
        </div>
      </div>

      <div class="sep"></div>

      <h2>Vægtprofiler</h2>
      <table class="tbl" id="weightTbl"></table>

      <div class="sep"></div>

      <div class="flex">
        <button class="btn" id="downloadPng">Download radar som PNG</button>
      </div>

    </div>
  </div>

<script>
(function(){
  // ----- Model definition -----
  const dimensions = [
    "Trust","Security","Love/Care","Respect","Communication","Reciprocity",
    "Commitment","Intimacy","SharedMeaning","Resilience","Admiration","PowerBalance"
  ];
  const baseWeights = {"Trust":0.12,"Security":0.08,"Love/Care":0.10,"Respect":0.08,"Communication":0.12,"Reciprocity":0.08,"Commitment":0.12,"Intimacy":0.08,"SharedMeaning":0.08,"Resilience":0.10,"Admiration":0.02,"PowerBalance":0.02};

  const typeMods = {
    "Romantisk": {"Intimacy":1.2,"Commitment":1.15,"Communication":1.1},
    "Forælder–barn": {"Love/Care":1.25,"Security":1.2,"Resilience":1.1},
    "Venskab": {"Reciprocity":1.2,"SharedMeaning":1.15,"Communication":1.1},
    "Mentor–mentee": {"Respect":1.2,"Admiration":1.4,"SharedMeaning":1.1},
    "Menneske–kæledyr": {"Love/Care":1.25,"Security":1.2,"Communication":0.9,"PowerBalance":0.9,"Intimacy":1.1},
    "Professionel": {"Respect":1.25,"Communication":1.15,"PowerBalance":1.2,"SharedMeaning":1.1},
    "Familie/Team": {"SharedMeaning":1.2,"Resilience":1.15,"Communication":1.1}
  };

  const presets = {
    "Romantisk": {years:6, perWeek:40, vol:0.25, scores:{"Trust":0.85,"Security":0.80,"Love/Care":0.90,"Respect":0.85,"Communication":0.80,"Reciprocity":0.85,"Commitment":0.88,"Intimacy":0.90,"SharedMeaning":0.82,"Resilience":0.78,"Admiration":0.65,"PowerBalance":0.80}},
    "Forælder–barn": {years:10, perWeek:60, vol:0.20, scores:{"Trust":0.92,"Security":0.95,"Love/Care":0.97,"Respect":0.80,"Communication":0.75,"Reciprocity":0.70,"Commitment":0.98,"Intimacy":0.88,"SharedMeaning":0.80,"Resilience":0.85,"Admiration":0.70,"PowerBalance":0.75}},
    "Venskab": {years:8, perWeek:6, vol:0.15, scores:{"Trust":0.82,"Security":0.70,"Love/Care":0.65,"Respect":0.85,"Communication":0.78,"Reciprocity":0.88,"Commitment":0.70,"Intimacy":0.62,"SharedMeaning":0.80,"Resilience":0.76,"Admiration":0.55,"PowerBalance":0.85}},
    "Mentor–mentee": {years:3, perWeek:2, vol:0.10, scores:{"Trust":0.80,"Security":0.78,"Love/Care":0.55,"Respect":0.92,"Communication":0.80,"Reciprocity":0.70,"Commitment":0.75,"Intimacy":0.45,"SharedMeaning":0.82,"Resilience":0.72,"Admiration":0.88,"PowerBalance":0.78}},
    "Menneske–kæledyr": {years:5, perWeek:70, vol:0.10, scores:{"Trust":0.90,"Security":0.92,"Love/Care":0.95,"Respect":0.75,"Communication":0.60,"Reciprocity":0.78,"Commitment":0.96,"Intimacy":0.90,"SharedMeaning":0.65,"Resilience":0.82,"Admiration":0.70,"PowerBalance":0.88}},
    "Professionel": {years:4, perWeek:25, vol:0.20, scores:{"Trust":0.75,"Security":0.75,"Love/Care":0.30,"Respect":0.88,"Communication":0.82,"Reciprocity":0.78,"Commitment":0.72,"Intimacy":0.25,"SharedMeaning":0.80,"Resilience":0.70,"Admiration":0.40,"PowerBalance":0.88}},
    "Familie/Team": {years:7, perWeek:20, vol:0.18, scores:{"Trust":0.86,"Security":0.85,"Love/Care":0.82,"Respect":0.84,"Communication":0.78,"Reciprocity":0.80,"Commitment":0.88,"Intimacy":0.60,"SharedMeaning":0.90,"Resilience":0.86,"Admiration":0.55,"PowerBalance":0.82}},
  };

  const relAdvice = {
    "Romantisk": {
      strengths:["Intimitet og kærlighed driver tilknytning","Commitment + kommunikation giver robusthed"],
      weaknesses:["Volatilitet ved uafklarede mål","Misforståelser når kommunikationen svigter"]
    },
    "Forælder–barn": {
      strengths:["Høj tryghed og omsorg","Lang varighed og hyppig interaktion"],
      weaknesses:["Magtbalance og autonomi i overgangsfaser","Kommunikation kan skure i teenagelivet"]
    },
    "Venskab": {
      strengths:["Gensidighed og fælles mening","Ofte lav volatilitet"],
      weaknesses:["Lavere commitment kan gøre den sårbar","Livsændringer kan øge afstand"]
    },
    "Mentor–mentee": {
      strengths:["Respekt + fælles retning = læring","Admiration kan motivere"],
      weaknesses:["Asymmetri og overafhængighed","Sårbar ved målafvigelser"]
    },
    "Menneske–kæledyr": {
      strengths:["Stor tryghed/omsorg/commitment","Høj daglig interaktion"],
      weaknesses:["Lav verbal kommunikation","Asymmetrisk magtbalance"]
    },
    "Professionel": {
      strengths:["Respekt og tydelig kommunikation","Sund magtbalance og mål"],
      weaknesses:["Lav intimitet/omsorg","Eksternt pres kan øge volatilitet"]
    },
    "Familie/Team": {
      strengths:["Fælles mening og resiliens","God buffer mod kriser"],
      weaknesses:["Rolleuklarhed skaber friktion","Kommunikationsbrist spreder sig hurtigt"]
    }
  };

  // ----- Utils -----
  const $ = sel => document.querySelector(sel);
  const el = (tag, cls) => { const n=document.createElement(tag); if(cls) n.className=cls; return n; };
  const clamp = (x,min,max) => Math.max(min,Math.min(max,x));

  function renorm(weights){
    const s = Object.values(weights).reduce((a,b)=>a+b,0);
    const out = {}; for(const k in weights) out[k] = weights[k]/s; return out;
  }

  function mergedWeights(relType){
    const w = {...baseWeights};
    const mods = typeMods[relType]||{};
    for(const k in w){ w[k] = w[k] * (mods[k]||1); }
    return renorm(w);
  }

  function durationFactor(years, k=0.5, cap=1.15){
    years = Math.max(0, years||0);
    return 1 + (cap - 1) * (1 - Math.exp(-k * years));
  }
  function interactionFactor(perWeek, cap=1.10){
    const x = Math.max(0, perWeek||0);
    return 1 + (cap - 1) * (1 - Math.exp(-0.25 * x));
  }
  function volatilityPenalty(v){
    v = clamp(v||0,0,1);
    return Math.max(0.85, 1 - 0.10 * v);
  }

  function computeCoreScore(scores, relType){
    const w = mergedWeights(relType);
    let s = 0; for(const d of dimensions){ s += (w[d]||0) * (scores[d]||0); }
    return s; // 0..1
  }
  function computeStrength(scores, relType, years, perWeek, vol){
    let s = computeCoreScore(scores, relType);
    s *= durationFactor(years);
    s *= interactionFactor(perWeek);
    s *= volatilityPenalty(vol);
    s = clamp(s, 0, 1.25);
    return 100 * s;
  }

  // ----- UI build -----
  const relSel = $('#relType');
  Object.keys(typeMods).forEach(t=>{
    const o = el('option'); o.value=t; o.textContent=t; relSel.appendChild(o);
  });
  relSel.value = 'Romantisk';

  const dimsBox = $('#dims');
  const sliders = {};
  function addSlider(name){
    const card = el('div','card'); card.style.padding='10px'; card.style.marginBottom='10px';
    const lbl = el('div','row');
    const title = el('label'); title.textContent = name; lbl.appendChild(title);
    const val = el('span','pill'); val.textContent = '0.70'; val.style.marginLeft='auto'; val.id = 'val_'+name; lbl.appendChild(val);

    const rng = el('input'); rng.type='range'; rng.min='0'; rng.max='1'; rng.step='0.01'; rng.value='0.70'; rng.addEventListener('input', ()=>{ val.textContent = Number(rng.value).toFixed(2); schedule(); });

    card.appendChild(lbl); card.appendChild(rng); dimsBox.appendChild(card);
    sliders[name] = rng;
  }
  dimensions.forEach(addSlider);

  // Meta inputs
  const years = $('#years'), perWeek = $('#perWeek'), vol = $('#vol');
  ;[years, perWeek, vol].forEach(i=> i.addEventListener('input', schedule));

  // Buttons
  $('#recalc').addEventListener('click', recalc);
  $('#reset').addEventListener('click', ()=>{ for(const d of dimensions){ sliders[d].value=0.70; $('#val_'+d).textContent='0.70'; } schedule(); });
  $('#loadPreset').addEventListener('click', ()=>{ const p = presets[relSel.value]; if(!p) return; years.value = p.years; perWeek.value=p.perWeek; vol.value=p.vol; for(const d of dimensions){ sliders[d].value=p.scores[d]; $('#val_'+d).textContent=p.scores[d].toFixed(2);} schedule(); });

  $('#saveJson').addEventListener('click', ()=>{
    const data = currentProfile();
    const blob = new Blob([JSON.stringify(data,null,2)], {type:'application/json'});
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = `relation_profile_${Date.now()}.json`;
    a.click();
  });
  $('#loadJson').addEventListener('click', ()=> $('#jsonFile').click());
  $('#jsonFile').addEventListener('change', async (e)=>{
    const f = e.target.files[0]; if(!f) return; const txt = await f.text();
    try{ const obj = JSON.parse(txt); applyProfile(obj); } catch(err){ alert('Ugyldig JSON'); }
  });

  // Weight table
  function renderWeightTable(){
    const tbl = $('#weightTbl'); tbl.innerHTML='';
    const w = mergedWeights(relSel.value);
    const thead = el('thead'); const trh = el('tr');
    trh.appendChild(th('Dimension')); trh.appendChild(th('Vægt')); thead.appendChild(trh); tbl.appendChild(thead);
    const tb = el('tbody');
    for(const d of dimensions){ const tr = el('tr'); tr.appendChild(td(d)); tr.appendChild(td(w[d].toFixed(3))); tb.appendChild(tr); }
    tbl.appendChild(tb);
    function th(x){ const n=el('th'); n.textContent=x; return n; }
    function td(x){ const n=el('td'); n.textContent=x; return n; }
  }

  // Strengths/Weaknesses text
  function renderInsights(scores){
    const arr = Object.entries(scores).sort((a,b)=>b[1]-a[1]);
    const top = arr.slice(0,3).map(([k,v])=>`<li><b>${k}</b>: ${v.toFixed(2)}</li>`).join('');
    const bot = arr.slice(-3).map(([k,v])=>`<li><b>${k}</b>: ${v.toFixed(2)}</li>`).join('');
    $('#strengths').innerHTML = (relAdvice[relSel.value]?.strengths||[]).map(s=>`<li>${s}</li>`).join('') + top;
    $('#weaknesses').innerHTML = (relAdvice[relSel.value]?.weaknesses||[]).map(s=>`<li>${s}</li>`).join('') + bot;
  }

  // Current profile IO
  function currentProfile(){
    const scores={}; for(const d of dimensions){ scores[d] = Number(sliders[d].value); }
    return { relType: relSel.value, years:Number(years.value), perWeek:Number(perWeek.value), vol:Number(vol.value), scores };
  }
  function applyProfile(p){
    if(p.relType && typeMods[p.relType]) relSel.value=p.relType;
    if(typeof p.years==='number') years.value=p.years; if(typeof p.perWeek==='number') perWeek.value=p.perWeek; if(typeof p.vol==='number') vol.value=p.vol;
    if(p.scores){ for(const d of dimensions){ if(typeof p.scores[d]==='number'){ sliders[d].value=p.scores[d]; $('#val_'+d).textContent=p.scores[d].toFixed(2);} } }
    schedule();
  }

  // ----- Radar chart drawing -----
  const canvas = $('#radar'); const ctx = canvas.getContext('2d');
  function drawRadar(scores){
    const W = canvas.width, H = canvas.height; const cx=W/2, cy=H/2; const R = Math.min(W,H)*0.38;
    ctx.clearRect(0,0,W,H);

    // grid
    ctx.save();
    ctx.translate(cx,cy);
    const steps = 5; ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--grid'); ctx.lineWidth=1;
    for(let s=1; s<=steps; s++){
      const r = (R*s/steps);
      ctx.beginPath(); for(let i=0;i<dimensions.length;i++){ const a = (-Math.PI/2) + i*(2*Math.PI/dimensions.length); const x=r*Math.cos(a), y=r*Math.sin(a); i?ctx.lineTo(x,y):ctx.moveTo(x,y);} ctx.closePath(); ctx.stroke();
    }
    // axes
    ctx.strokeStyle = '#2f3b6d';
    for(let i=0;i<dimensions.length;i++){
      const a = (-Math.PI/2) + i*(2*Math.PI/dimensions.length); ctx.beginPath(); ctx.moveTo(0,0); ctx.lineTo(R*Math.cos(a), R*Math.sin(a)); ctx.stroke();
    }

    // labels
    ctx.fillStyle = '#c9d6ff'; ctx.font = '14px system-ui';
    for(let i=0;i<dimensions.length;i++){
      const a = (-Math.PI/2) + i*(2*Math.PI/dimensions.length);
      const rx = (R+18)*Math.cos(a), ry = (R+18)*Math.sin(a);
      drawLabel(dimensions[i], rx, ry);
    }

    // polygon
    ctx.beginPath();
    const vals = dimensions.map(d=>scores[d]||0);
    for(let i=0;i<dimensions.length;i++){
      const a = (-Math.PI/2) + i*(2*Math.PI/dimensions.length);
      const r = R * vals[i];
      const x = r*Math.cos(a), y = r*Math.sin(a);
      i?ctx.lineTo(x,y):ctx.moveTo(x,y);
    }
    ctx.closePath();
    ctx.strokeStyle = '#8fb2ff'; ctx.lineWidth=2; ctx.stroke();
    ctx.fillStyle = 'rgba(122,162,255,0.18)'; ctx.fill();

    ctx.restore();
  }

  function drawLabel(text, x, y){
    ctx.save(); ctx.translate(canvas.width/2 + x, canvas.height/2 + y); ctx.textAlign = (x< -10)?'right': (x>10?'left':'center'); ctx.textBaseline = (y<-10)?'bottom':(y>10?'top':'middle'); ctx.fillText(text,0,0); ctx.restore();
  }

  // ----- Recalc & render -----
  const dbgD = $('#dbgD'), dbgF = $('#dbgF'), dbgP = $('#dbgP');
  const scoreTxt = $('#scoreTxt'); const bar = $('#bar');

  function recalc(){
    const prof = currentProfile();
    const D = durationFactor(prof.years);
    const F = interactionFactor(prof.perWeek);
    const P = volatilityPenalty(prof.vol);
    dbgD.textContent = D.toFixed(3); dbgF.textContent = F.toFixed(3); dbgP.textContent = P.toFixed(3);

    const strength = computeStrength(prof.scores, prof.relType, prof.years, prof.perWeek, prof.vol);
    scoreTxt.textContent = strength.toFixed(1);
    bar.style.width = Math.max(0, Math.min(100, strength)).toFixed(1)+'%';

    $('#chartTitle').textContent = `${prof.relType} — Radar-plot`;
    drawRadar(prof.scores);
    renderWeightTable();
    renderInsights(prof.scores);
  }

  let rafId=null; function schedule(){ if(rafId) cancelAnimationFrame(rafId); rafId = requestAnimationFrame(recalc); }

  // Download PNG
  $('#downloadPng').addEventListener('click', ()=>{
    const a = document.createElement('a');
    a.href = canvas.toDataURL('image/png');
    a.download = 'relation_radar.png';
    a.click();
  });

  // Init defaults
  schedule();
})();
</script>
</body>
</html>
